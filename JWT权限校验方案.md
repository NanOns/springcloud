## JWT权限校验


### 经典的微服务权限验证解决方案
1.单点登录（SSO）方案
```
采用单点登录方案，意味着每个面向用户的服务都必须与认证服务交互，
这会产生大量非常琐碎的网络流量，同时这个防范实现起来也相当的复杂。
在其他方面，选择SSO方案安全性会很好，

用户登录状态是不透明的，可防止攻击者从状态中推断任何有用的信息。
```
2.分布式会话方案(redis存储session)
```
优点:
原理主要是将关于用户信息存储在共享内存中，并通常由用户会话作为key来实现简单的分布式哈希映射。
当用户访问微服务时，用户数据可以从共享存储中获取。
该方案的另外一个优点就是: 用户登录状态不是透明的。

缺点:高度依赖第三方redis的稳定性
```

3.token客户端令牌方案
```
优点:
此令牌在客户端生成，由身份验证服务进行签名，并且必须包含足够的信息，以便可以在所有微服务中建立用户身份。
令牌会附加到每一个请求上，为微服务提供身份验证。

缺点:
这种解决方案安全性相对较好，但身份验证注销是一个大大的问题，
缓解这种情况的方法可以使用短期令牌access_token 和频繁检查认证服务器等。

```

4.客户端令牌与API网关结合(JWT)
```
优点:
这个方案意味着所有的请求都通过网关，从而有效地隐藏了微服务。
在请求时，网关将原始用户令牌转换为内部会话（session）ID令牌。
在这种情况下，注销就不在是个大大的问题, 因为网关在注销时可以撤销用户的令牌

缺点:
实现相对复杂

```

#### 基于JWT 验证时序图
![输入图片说明](https://github.com/qccr-twl2123/livtrip/blob/master/src/main/resources/static/resources/images/JWT时序.png "在这里输入图片标题")


#### JWT认证原理简介
```
1.认证流程

客户端调用登录接口（或者获取 token 接口），传入用户名密码。
服务端请求身份认证中心，确认用户名密码正确。
服务端创建 JWT，返回给客户端。
客户端拿到 JWT，进行存储（可以存储在缓存中，也可以存储在数据库中，如果是浏览器，可以存储在 Cookie 中）在后续请求中，在 HTTP 请求头中加上 JWT。
服务端校验 JWT，校验通过后，返回相关资源和数据。


2.JWT结构
JWT 是由三段信息构成的:
第一段为头部（Header），
第二段为载荷（Payload)，
第三段为签名（Signature）。

每一段内容都是一个 JSON 对象，将每一段 JSON 对象采用 BASE64 编码，将编码后的内容用.
链接一起就构成了 JWT 字符串

```


参考博客:

http://www.infoq.com/cn/articles/identity-authentication-of-architecture-in-micro-service













